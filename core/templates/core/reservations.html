{% extends 'core/base.html' %}
{% block title %}
{{ year }}-{{ month }}-{{ day }}
{% endblock %}

{% block map %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

<script src="https://maps.googleapis.com/maps/api/js?key={{ key }}&callback=initMap&libraries=&v=weekly" async></script>

	<script>
	function initMap() {
		  const map = new google.maps.Map(document.getElementById("map"), {
			      zoom: 5,
			  center: { lat: 52.0692, lng: 19.4773 },
			      mapTypeId: "terrain",
			    });
		  {% for r in yesterday %}
			const y{{ r.id }}Coords = [
				{% for c in r.airspace.coordinates %}
					{ lat: {{ c.lat }}, lng: {{ c.lon }} },
				{% endfor %}
			    ];
			const y{{ r.id }} = new google.maps.Polygon({
			    paths: y{{ r.id }}Coords,
				{% if r.status.name == "ACTIVATED" %}
			      		strokeColor: "#FF0000",
			      		fillColor: "#FF0000",
				{% else %}
			      		strokeColor: "#FFFF00",
			      		fillColor: "#FFFF00",
				{% endif %}
			      strokeOpacity: 0.8,
			      strokeWeight: 2,
			      fillOpacity: 0.35,
			    });
			y{{ r.id }}.setMap(map);
		  {% endfor %}
		  {% for r in reservations %}
			const r{{ r.id }}Coords = [
				{% for c in r.airspace.coordinates %}
					{ lat: {{ c.lat }}, lng: {{ c.lon }} },
				{% endfor %}
			    ];
			const r{{ r.id }} = new google.maps.Polygon({
			    paths: r{{ r.id }}Coords,
				{% if r.status.name == "ACTIVATED" %}
			      		strokeColor: "#FF0000",
			      		fillColor: "#FF0000",
				{% else %}
			      		strokeColor: "#FFFF00",
			      		fillColor: "#FFFF00",
				{% endif %}
			      strokeOpacity: 0.8,
			      strokeWeight: 2,
			      fillOpacity: 0.35,
			    });
			r{{ r.id }}.setMap(map);
		  {% endfor %}
		  {% for r in other %}
			const o{{ r.id }}Coords = [
				{% for c in r.airspace.coordinates %}
					{ lat: {{ c.lat }}, lng: {{ c.lon }} },
				{% endfor %}
			    ];
			const o{{ r.id }} = new google.maps.Polygon({
			    paths: o{{ r.id }}Coords,
				{% if r.status.name == "ACTIVATED" %}
			      		strokeColor: "#FF0000",
			      		fillColor: "#FF0000",
				{% else %}
			      		strokeColor: "#FFFF00",
			      		fillColor: "#FFFF00",
				{% endif %}
			      strokeOpacity: 0.8,
			      strokeWeight: 2,
			      fillOpacity: 0.35,
			    });
			o{{ r.id }}.setMap(map);
		  {% endfor %}
	}

	</script>
<style>
#map{
	width: 100%;
	height: 300px;
	display: none;
}
</style>

{% endblock %}
{% block content %}
<h1>Stan stref powietrznych na dzień {{ year }}-{{ month }}-{{ day }}</h1>
<div id="map" class="container"></div>
{% if (yesterday is defined) and yesterday %}
<h2>Strefy rezerwowane w dniu poprzednim, których rezerwacja kończy się w dniu {{ year }}-{{ month }}-{{ day }}*</h2>
<table class="table table-striped">
	<tr><th scope="col">Typ</th><th scope="col">Desygnator</th><th scope="col">Okres rezerwacji</th><th scope="col">Zakres wysokości</th><th scope="col">Uwagi</th><th scope="col">Status</th></tr>
{% for r in yesterday %}
<tr><td>{{ r.airspace.typ }}</td><td><a href="{{ url_for('core_bp.airspace_reservations',name=r.airspace.designator) }}">{{ r.airspace.designator }}</a></td><td>{{ r.start }}Z - {{ r.end }}Z </td><td>{{r.lower_altitude }}-{{ r.upper_altitude }}{{ r.altitude_unit }}</td><td>{{ r.remarks }}</td><td>{{ r.status.name }}</td></tr>
{% endfor %}
</table>
{% endif %}

{% if (reservations is defined) and reservations %}
<h2>Strefy aktywowane {{ year }}-{{ month }}-{{ day }}*</h2>
<table class="table table-striped">
	<tr><th scope="col">Typ</th><th scope="col">Desygnator</th><th scope="col">Okres rezerwacji</th><th scope="col">Zakres wysokości</th><th scope="col">Uwagi</th><th scope="col">Status</th></tr>
{% for r in reservations %}
<tr><td>{{ r.airspace.typ }}</td><td><a href="{{ url_for('core_bp.airspace_reservations',name=r.airspace.designator) }}">{{ r.airspace.designator }}</a></td><td>{{ r.start }}Z - {{ r.end }}Z </td><td>{{r.lower_altitude }}-{{ r.upper_altitude }}{{ r.altitude_unit }}</td><td>{{ r.remarks }}</td><td>{{ r.status.name }}</td></tr>
{% endfor %}
</table>
{% endif %}

{% if (other is defined) and other %}
<h2>Strefy zarezerwowane, bez potwierdzenia aktywacji*</h2>
<table class="table table-striped" > 
	<tr><th scope="col">Typ</th><th cope="col">Desygnator</th><th scope="col">Okres rezerwacji</th><th scope="col">Zakres wysokości</th><th scope="col">Uwagi</th><th scope="col">Status</th></tr>
{% for r in other %}
<tr><td>{{ r.airspace.typ }}</td><td><a href="{{ url_for('core_bp.airspace_reservations',name=r.airspace.designator) }}">{{ r.airspace.designator }}</a></td><td>{{ r.start }}Z - {{ r.end }}Z </td><td>{{r.lower_altitude }}-{{ r.upper_altitude }}{{ r.altitude_unit }}</td><td>{{ r.remarks }}</td><td>{{ r.status.name }}</td></tr>
{% endfor %}
</table>
{% endif %}

<p><small>*Źródło AUP oraz UUP publikowany przez PANSA, lokalne dane aktualizowane co 30 minut <br>*Przed rozpoczęciem lotów zawsze potwierdź zajętość stref w FIS
<ul>
	<li>UAV/BSP - UNMANNED AERIAL VEHICLE/BEZZALOGOWY STATEK POWIETRZNY</li>
	<li>RPA - REMOTELY PILOTED AIRCRAFT/ZDALNIE STEROWANE BEZZALOGOWE STATKI POWIETRZNE</li>
	<li>/W - W PRZYPADKU KONFLIKTU ZE STRUKTURA Z PRZYZNANYM PRIORYTETEM ZEZWOLENIE JEST WYDAWANE WARUNKOWO /W - CONDITIONAL PERMISSION IN CASE OF A CONFLICT WITH AN AREA HAVING A PRIORITY</li>
	<li>CLN - STREFA KOLIZYJNA - PATRZ AIP ENR 2.2.2-2 PUNKT 4 / CONFLICT AREA - SEE AIP ENR 2.2.2-2 POINT 4</li>
</ul>
</small>
</p>
{% endblock %}

